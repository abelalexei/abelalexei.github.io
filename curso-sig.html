<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desaf√≠o SIG y Teledetecci√≥n</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Configuraci√≥n de la fuente Inter */
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            /* Fondo que simula datos satelitales/mapa de calor - Colores Llamativos */
            background: radial-gradient(circle at top left, #3b82f6 0%, #1d4ed8 20%, transparent 80%),
                        radial-gradient(circle at bottom right, #f87171 0%, #ef4444 20%, transparent 80%),
                        #1f2937; /* Fondo oscuro (espacio/oc√©ano) */
            background-blend-mode: screen;
            transition: background-color 0.5s ease;
        }
        /* Estilo para el spinner de carga */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .spinner-border {
            width: 1.5rem;
            height: 1.5rem;
            display: inline-block;
            vertical-align: text-bottom;
            border: 0.2em solid currentColor;
            border-right-color: transparent;
            border-radius: 50%;
            animation: spin 0.75s linear infinite;
        }
        /* Icono de Sat√©lite para el t√≠tulo */
        .satellite-icon {
            display: inline-block;
            transform: rotate(-15deg);
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
</head>
<body class="p-4">

    <script>
        // --- L√≥gica de Integraci√≥n de la API de Gemini ---

        // Constantes de configuraci√≥n de la API
        const apiKey = "";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
        const QUESTION_PLACEHOLDER = 'Presiona "Pregunta Siguiente" para comenzar el desaf√≠o.';
        
        // Elementos del DOM
        let questionTextElement, generateButton, spinner;

        /**
         * Inicializa los elementos del DOM despu√©s de que la ventana carga.
         */
        window.onload = () => {
            questionTextElement = document.getElementById('questionText');
            generateButton = document.getElementById('generateButton');
            spinner = document.getElementById('spinner');

            if (generateButton) {
                generateButton.addEventListener('click', generateRemoteSensingQuestion);
            }
            if (questionTextElement) {
                questionTextElement.textContent = QUESTION_PLACEHOLDER;
            }
        };

        /**
         * Realiza la llamada a la API de Gemini con retroceso exponencial (exponential backoff).
         * @param {string} url - URL del endpoint de la API.
         * @param {object} payload - Cuerpo de la solicitud JSON.
         * @param {number} maxRetries - N√∫mero m√°ximo de reintentos.
         * @returns {Promise<{text: string}>}
         */
        const makeApiCall = async (url, payload, maxRetries = 5) => {
            const fetchWithRetry = async (attempt) => {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 429 && attempt < maxRetries) {
                            const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                            await new Promise(resolve => setTimeout(resolve, delay));
                            return fetchWithRetry(attempt + 1);
                        }
                        throw new Error(`Error HTTP! Estado: ${response.status}`);
                    }

                    const result = await response.json();
                    const candidate = result.candidates?.[0];

                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        return { text: candidate.content.parts[0].text };
                    } else {
                        throw new Error("Estructura de respuesta inv√°lida o contenido faltante de la API.");
                    }
                } catch (error) {
                    if (attempt < maxRetries) {
                        const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        return fetchWithRetry(attempt + 1);
                    }
                    throw error;
                }
            };
            return fetchWithRetry(1);
        };

        /**
         * Funci√≥n principal para generar una pregunta usando Gemini.
         */
        const generateRemoteSensingQuestion = async () => {
            if (!questionTextElement || !generateButton || !spinner) return;

            // Desactivar bot√≥n y mostrar spinner
            generateButton.disabled = true;
            generateButton.innerHTML = '<span class="spinner-border mr-2" role="status" aria-hidden="true"></span> Cargando...';
            spinner.classList.remove('hidden');
            questionTextElement.textContent = ''; 

            // Instrucciones para el LLM: generar una pregunta educativa compleja.
            const userQuery = "Genera una pregunta educativa compleja sobre Teledetecci√≥n (Sensores Remotos) y Sistemas de Informaci√≥n Geogr√°fica (SIG).";
            const systemPrompt = "Eres un instructor universitario experto en geom√°tica. Genera una pregunta t√©cnica o conceptual avanzada sobre la intersecci√≥n entre Teledetecci√≥n, Sensores Remotos y Sistemas de Informaci√≥n Geogr√°fica (SIG). La respuesta debe ser S√ìLO la pregunta, formulada en espa√±ol y concisa, sin introducciones ni la respuesta. Ejemplo: '¬øC√≥mo afecta la correcci√≥n atmosf√©rica a la clasificaci√≥n supervisada de im√°genes multiespectrales en QGIS?'";
            
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                // No se necesita Google Search para este tipo de generaci√≥n creativa/educativa
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const result = await makeApiCall(apiUrl, payload);
                // Limpiar y mostrar el texto generado
                questionTextElement.textContent = result.text.trim();
                
            } catch (error) {
                questionTextElement.textContent = 'Error: No se pudo generar la pregunta. Int√©ntalo de nuevo.';
                console.error("API Error:", error);
            } finally {
                // Restaurar estado del bot√≥n
                generateButton.disabled = false;
                generateButton.innerHTML = 'Pregunta Siguiente';
                spinner.classList.add('hidden');
            }
        };
    </script>

    <!-- Contenedor Principal Centrado -->
    <main class="w-full max-w-4xl p-6 md:p-10 lg:p-12">
        <div class="bg-white/90 backdrop-blur-sm rounded-3xl shadow-2xl p-8 md:p-12 border-4 border-yellow-400/70 text-gray-900">

            <!-- T√≠tulo Principal del Curso -->
            <h1 class="text-4xl sm:text-5xl lg:text-7xl font-extrabold text-center text-red-600 leading-tight tracking-tighter">
                <span class="text-yellow-600 satellite-icon">üõ∞Ô∏è</span> Curso de SIG
            </h1>
            <h2 class="text-xl sm:text-2xl text-center text-gray-700 font-light mt-2 mb-8">
                Desaf√≠a tus conocimientos en Teledetecci√≥n y Sensores Remotos
            </h2>

            <!-- Contenedor de la Pregunta Generada por IA -->
            <div id="questionContainer" class="min-h-[150px] flex items-center justify-center p-6 bg-blue-50/70 rounded-xl shadow-inner border-l-4 border-blue-500">
                <p id="questionText" class="text-xl md:text-2xl font-semibold text-center text-blue-800">
                    <!-- Placeholder inicial -->
                </p>
                <!-- Indicador de carga -->
                <div id="spinner" class="hidden text-blue-600">
                    <div class="spinner-border"></div>
                </div>
            </div>
            
            <!-- Bot√≥n de Acci√≥n -->
            <div class="mt-8 text-center">
                <button id="generateButton" class="px-10 py-4 bg-green-500 text-white text-xl font-black rounded-full shadow-2xl hover:bg-green-600 transition duration-300 transform hover:scale-[1.05] focus:outline-none focus:ring-4 focus:ring-green-400 focus:ring-opacity-70">
                    Pregunta Siguiente
                </button>
            </div>
            
            <!-- Pie de p√°gina simple -->
            <footer class="mt-12 pt-4 border-t border-gray-300 text-center text-sm text-gray-500">
                ¬© 2025 Facultad de Ciencias Agron√≥micas Universidad de El Salvador. Propulsado por IA.
            </footer>

        </div>
    </main>

</body>
</html>
